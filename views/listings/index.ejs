<% layout('/layouts/boilerplate') %>
<script src="/js/category-filter.js" defer></script>

<link rel="stylesheet" href="/css/category-filter.css">
<div class="listings-container">
    <!-- Search and Filter Section -->
    <div class="search-filters-container">
        <div class="categories-wrapper">
            <div class="categories-scroll">
                <% const categories = [
                    { name: 'Trending', icon: 'fa-fire', param: 'trending', color: '#FF385C' },
                    { name: 'Rooms', icon: 'fa-bed', param: 'rooms', color: '#914669' },
                    { name: 'Iconic Cities', icon: 'fa-city', param: 'iconic-cities', color: '#CC2D4A' },
                    { name: 'Mountains', icon: 'fa-mountain', param: 'mountains', color: '#BC1A6E' },
                    { name: 'Amazing Pools', icon: 'fa-swimming-pool', param: 'pools', color: '#D93B30' },
                    { name: 'Camping', icon: 'fa-campground', param: 'camping', color: '#CC2D4A' },
                    { name: 'Farms', icon: 'fa-wheat-awn', param: 'farms', color: '#BC1A6E' },
                    { name: 'Arctic', icon: 'fa-snowflake', param: 'arctic', color: '#428BFF' },
                    { name: 'Domes', icon: 'fa-igloo', param: 'domes', color: '#DE3151' },
                    { name: 'Boats', icon: 'fa-sailboat', param: 'boats', color: '#D93B30' }
                ] %>

                <% categories.forEach(category => { %>
                    <a href="/listings?category=<%= category.param %>" 
                       class="category-item <%= ((req && req.query && req.query.category === category.param) ? 'active' : '') %>"
                       data-category="<%= category.param %>">
                        <div class="category-icon" style="color: <%= category.color %>">
                            <i class="fa-solid <%= category.icon %>"></i>
                        </div>
                        <span><%= category.name %></span>
                    </a>
                <% }) %>
            </div>
            <button class="nav-btn prev-btn" onclick="scrollCategories(-200)">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="nav-btn next-btn" onclick="scrollCategories(200)">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <div class="filters-toggle">
            <button class="btn btn-filters" onclick="toggleFilters()">
                <i class="fas fa-sliders-h"></i>
                <span>Filters</span>
            </button>
            <div class="tax-display">
                <label class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" id="showTaxes" checked>
                    <span class="form-check-label">Display total after taxes</span>
                </label>
            </div>
        </div>
    </div>
    </div>
    <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3">
    
      <% if (allListings && allListings.length > 0) { %>
      <% for(let listing of allListings){   %>
        <a href="/listings/<%= listing._id %>" class="listing-link">
        <div class="card col listing-card" style="width: 20rem">
          <img
           class="card-img-top" 
           src="<%=listing.image.url %>" 
           alt="listing_image" style="height: 20rem">
          <div class ="card-img-overlay"></div>
      
          <div class="card-body">
            <p class="card-text">
              <b><%= listing.title %> <br/></b>
              &#8377;<%=listing.price.toLocaleString("en-IN")%> /night
              <i class="tax-info"> &nbsp; &nbsp;+18% GST</i>
              </p>
          </div>
        </div>
       </a>
      <% }  %>
      <% } else { %>
          <div class="col-12 mt-4">
              <p>No listings found for your search/filter criteria.</p>
          </div>
      <% } %>
    </div>
  <script>
    let taxSwitch 
    = document.getElementById("switchCheckDefault")
    taxSwitch.addEventListener("click",()=>{
      let taxInfo = document.getElementsByClassName("tax-info");
      for(info of taxInfo){
        if(info.style.display != "inline"){

          info.style.display = "inline";
        }else{
          info.style.display = "none";
        }
      }
    })
  </script>
</body>